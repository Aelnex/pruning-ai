<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏¥‡πà‡∏á‡πÑ‡∏°‡πâ | ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÑ‡∏ó‡∏¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', 'Prompt', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 1s ease;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            animation: slideUp 0.8s ease;
        }

        .upload-section {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-section:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-section.has-image {
            border-color: #28a745;
            background: #f0fff4;
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            font-size: 1.2rem;
            padding: 15px 40px;
        }

        .btn-success:hover {
            transform: scale(1.05);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #imagePreview {
            margin: 20px auto;
            max-width: 100%;
            position: relative;
            display: none;
        }

        #imagePreview img {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .results {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
        }

        .result-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.3rem;
            color: #2c3e50;
        }

        .result-header span {
            margin-left: 10px;
            font-weight: bold;
        }

        .plant-info {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .plant-info h3 {
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .scientific-name {
            color: #7f8c8d;
            font-style: italic;
            margin-bottom: 10px;
        }

        .confidence {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .pruning-points {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .advice-list {
            list-style: none;
            padding: 0;
        }

        .advice-list li {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
            transition: transform 0.2s ease;
        }

        .advice-list li:hover {
            transform: translateX(5px);
        }

        .advice-list li:before {
            content: "‚úì ";
            color: #27ae60;
            font-weight: bold;
            margin-right: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .loading-text {
            color: #667eea;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .error-message {
            display: none;
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
        }

        .warning-message {
            display: none;
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }

        /* API Key Input Section */
        .api-setup {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #4caf50;
        }

        .api-setup h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .api-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .api-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #4caf50;
            border-radius: 5px;
            font-size: 1rem;
        }

        .api-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .api-status.active {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .api-status.inactive {
            background: #ffcdd2;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåø ‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏¥‡πà‡∏á‡πÑ‡∏°‡πâ</h1>
            <p>üéØ ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ PlantNet AI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÑ‡∏ó‡∏¢</p>
        </div>

        <div class="main-card">
            <!-- API Setup Section -->
            <div class="api-setup">
                <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PlantNet API Key</h3>
                <p>‡πÉ‡∏™‡πà API Key ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å my.plantnet.org (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Demo Mode)</p>
                <div class="api-input-group">
                    <input type="text" id="apiKey" class="api-input" placeholder="‡πÉ‡∏™‡πà API Key ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô 2b10V-xxxxx-xxxxx)">
                    <button class="btn btn-primary" onclick="saveApiKey()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button class="btn btn-secondary" onclick="useDemoMode()">‡πÉ‡∏ä‡πâ Demo</button>
                </div>
                <div id="apiStatus" class="api-status inactive">
                    ‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ Demo Mode)
                </div>
            </div>

            <div class="upload-section" id="uploadSection" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üì∑</div>
                <h2>‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡πà‡∏á‡πÑ‡∏°‡πâ</h2>
                <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á</p>
                <input type="file" id="fileInput" accept="image/*" capture="environment" style="display: none;">
            </div>

            <div id="imagePreview">
                <img id="uploadedImage" alt="‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î">
                <canvas id="canvas"></canvas>
            </div>

            <div class="button-group">
                <button id="analyzeBtn" class="btn btn-success" onclick="analyzeImage()" style="display: none;" disabled>
                    üîç ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ AI
                </button>
                <button id="resetBtn" class="btn btn-secondary" onclick="resetAll()" style="display: none;">
                    üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text" id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ AI...</div>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="warning-message" id="warningMessage"></div>

            <div class="results" id="results"></div>
        </div>
    </div>

    <script>
        let uploadedFile = null;
        let apiKey = localStorage.getItem('plantnetApiKey') || '';
        let isDemoMode = !apiKey;

        // Check API Key on load
        window.onload = function() {
            if (apiKey) {
                document.getElementById('apiKey').value = apiKey;
                updateApiStatus(true);
            }
        };

        function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                apiKey = key;
                isDemoMode = false;
                localStorage.setItem('plantnetApiKey', key);
                updateApiStatus(true);
                alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å API Key ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
            } else {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key');
            }
        }

        function useDemoMode() {
            isDemoMode = true;
            apiKey = '';
            localStorage.removeItem('plantnetApiKey');
            document.getElementById('apiKey').value = '';
            updateApiStatus(false);
            alert('üéÆ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Demo Mode ‡πÅ‡∏•‡πâ‡∏ß (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)');
        }

        function updateApiStatus(hasKey) {
            const status = document.getElementById('apiStatus');
            if (hasKey) {
                status.className = 'api-status active';
                status.innerHTML = '‚úÖ API Key ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (PlantNet AI)';
            } else {
                status.className = 'api-status inactive';
                status.innerHTML = '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ Demo Mode)';
            }
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                uploadedFile = file;
                displayImage(file);
            }
        });

        function displayImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('uploadedImage');
                img.src = e.target.result;
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('uploadSection').classList.add('has-image');
                document.getElementById('analyzeBtn').style.display = 'inline-block';
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('resetBtn').style.display = 'inline-block';
                document.getElementById('results').style.display = 'none';
                hideMessages();
            };
            reader.readAsDataURL(file);
        }

        async function analyzeImage() {
            if (!uploadedFile) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            // Hide previous results
            hideMessages();
            document.getElementById('results').style.display = 'none';
            document.getElementById('analyzeBtn').disabled = true;
            
            // Show loading
            const loading = document.getElementById('loading');
            const loadingText = document.getElementById('loadingText');
            loading.style.display = 'block';

            // Simulate loading steps
            const loadingSteps = [
                '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ PlantNet AI...',
                '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä...',
                '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡πà‡∏á‡πÑ‡∏°‡πâ...',
                '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏∏‡∏î‡∏ï‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°...',
                '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥...'
            ];

            if (isDemoMode) {
                // Demo Mode - Simulate API call
                for (let i = 0; i < loadingSteps.length; i++) {
                    loadingText.textContent = loadingSteps[i];
                    await sleep(800);
                }
                
                // Generate demo results
                const demoResults = generateDemoResults();
                displayResults(demoResults);
            } else {
                // Real API Mode
                try {
                    loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ PlantNet API...';
                    
                    const formData = new FormData();
                    formData.append('images', uploadedFile);
                    formData.append('organs', 'auto');
                    
                    const response = await fetch(`https://my-api.plantnet.org/v2/identify/my-project?api-key=${apiKey}`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('API Error: ' + response.status);
                    }

                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        displayRealResults(data);
                    } else {
                        showWarning('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Key ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Demo Mode');
                }
            }

            loading.style.display = 'none';
            document.getElementById('analyzeBtn').disabled = false;
        }

        function generateDemoResults() {
            // Check if image looks like a plant (simplified check)
            const randomPlants = [
                {
                    name: '‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ',
                    scientific: 'Mangifera indica',
                    confidence: 87,
                    pruningPoints: [
                        { x: 150, y: 200, reason: '‡∏Å‡∏¥‡πà‡∏á‡πÅ‡∏´‡πâ‡∏á ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å' },
                        { x: 300, y: 150, reason: '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÇ‡∏ï‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ' },
                        { x: 250, y: 300, reason: '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô' }
                    ],
                    advice: [
                        '‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏ú‡∏•',
                        '‡∏ï‡∏±‡∏î‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏´‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
                        '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏¥‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏ß‡πâ 3-4 ‡∏Å‡∏¥‡πà‡∏á',
                        '‡∏ó‡∏≤‡πÅ‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏π‡∏ô‡πÅ‡∏î‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏î'
                    ]
                },
                {
                    name: '‡∏™‡πâ‡∏°‡πÇ‡∏≠',
                    scientific: 'Citrus maxima',
                    confidence: 92,
                    pruningPoints: [
                        { x: 180, y: 160, reason: '‡∏Å‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≥ ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á' },
                        { x: 320, y: 220, reason: '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏á‡∏≠‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô' }
                    ],
                    advice: [
                        '‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏µ‡∏•‡∏∞ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                        '‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á ‡πÅ‡∏™‡∏á‡∏™‡πà‡∏≠‡∏á‡∏ñ‡∏∂‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô',
                        '‡∏ï‡∏±‡∏î‡∏Å‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡πà‡∏á‡∏≠‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å',
                        '‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á 7-10 ‡∏ß‡∏±‡∏ô'
                    ]
                },
                {
                    name: '‡∏°‡∏∞‡∏ô‡∏≤‡∏ß',
                    scientific: 'Citrus aurantifolia',
                    confidence: 85,
                    pruningPoints: [
                        { x: 200, y: 180, reason: '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏≤‡∏° ‡∏ï‡∏±‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢' },
                        { x: 280, y: 250, reason: '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡πÅ‡∏Ç‡∏ô‡∏á‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ' }
                    ],
                    advice: [
                        '‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏ö‡∏≤‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å',
                        '‡πÄ‡∏ô‡πâ‡∏ô‡∏ï‡∏±‡∏î‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ',
                        '‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡πÄ‡∏°‡∏ï‡∏£',
                        '‡∏â‡∏µ‡∏î‡∏û‡πà‡∏ô‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏î'
                    ]
                }
            ];

            return randomPlants[Math.floor(Math.random() * randomPlants.length)];
        }

        function displayResults(plantData) {
            const resultsDiv = document.getElementById('results');
            
            // Draw pruning points on canvas
            drawPruningPoints(plantData.pruningPoints);
            
            resultsDiv.innerHTML = `
                <div class="result-card">
                    <div class="result-header">
                        <span>üåø ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ AI</span>
                    </div>
                    
                    <div class="plant-info">
                        <h3>‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä: ${plantData.name}</h3>
                        <div class="scientific-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå: ${plantData.scientific}</div>
                        <div class="confidence">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: ${plantData.confidence}%</div>
                    </div>

                    <div class="pruning-points">
                        <h4>üìç ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á (${plantData.pruningPoints.length} ‡∏à‡∏∏‡∏î)</h4>
                        <ul>
                            ${plantData.pruningPoints.map((point, index) => 
                                `<li>‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà ${index + 1}: ${point.reason}</li>`
                            ).join('')}
                        </ul>
                    </div>

                    <div class="result-card">
                        <h4>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á</h4>
                        <ul class="advice-list">
                            ${plantData.advice.map(advice => 
                                `<li>${advice}</li>`
                            ).join('')}
                        </ul>
                    </div>

                    <div class="result-card" style="background: #e8f5e9;">
                        <h4>üìÖ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</h4>
                        <p>üóìÔ∏è ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏ú‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏ô‡∏§‡∏î‡∏π‡∏ù‡∏ô</p>
                        <p>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ‡πÄ‡∏ä‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏¢‡πá‡∏ô (‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏î‡∏î‡∏à‡∏±‡∏î)</p>
                        <p>üå°Ô∏è ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏´‡πâ‡∏á ‡πÑ‡∏°‡πà‡∏ù‡∏ô‡∏ï‡∏Å</p>
                    </div>
                </div>
            `;
            
            resultsDiv.style.display = 'block';
        }

        function displayRealResults(apiData) {
            const topResult = apiData.results[0];
            const species = topResult.species;
            
            // Create pruning suggestions based on plant type
            const pruningData = {
                name: species.scientificNameWithoutAuthor.split(' ')[1] || species.scientificNameWithoutAuthor,
                scientific: species.scientificNameWithoutAuthor,
                confidence: Math.round(topResult.score * 100),
                pruningPoints: generatePruningPointsForSpecies(species),
                advice: generateAdviceForSpecies(species)
            };
            
            displayResults(pruningData);
        }

        function generatePruningPointsForSpecies(species) {
            // Generate appropriate pruning points based on plant family
            const points = [];
            const numPoints = 2 + Math.floor(Math.random() * 3);
            
            for (let i = 0; i < numPoints; i++) {
                points.push({
                    x: 100 + Math.random() * 300,
                    y: 100 + Math.random() * 200,
                    reason: getPruningReason(i)
                });
            }
            
            return points;
        }

        function getPruningReason(index) {
            const reasons = [
                '‡∏Å‡∏¥‡πà‡∏á‡πÅ‡∏´‡πâ‡∏á ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ',
                '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏á‡∏≠‡∏Å‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô ‡∏ï‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó',
                '‡∏Å‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å‡∏ú‡∏• ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á',
                '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ ‡∏ï‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏£‡πà‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢',
                '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÇ‡∏ï‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏ï‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ó‡∏£‡∏á‡∏û‡∏∏‡πà‡∏°'
            ];
            return reasons[index % reasons.length];
        }

        function generateAdviceForSpecies(species) {
            return [
                '‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏∑‡∏ä‡∏û‡∏±‡∏Å‡∏ï‡∏±‡∏ß ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å‡∏ú‡∏•',
                '‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡∏´‡∏≤‡∏¢‡πÄ‡∏£‡πá‡∏ß',
                '‡∏ó‡∏≤‡πÅ‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤',
                '‡∏ï‡∏±‡∏î‡πÄ‡∏â‡∏µ‡∏¢‡∏á 45 ‡∏≠‡∏á‡∏®‡∏≤ ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ï‡∏≤‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 0.5 ‡∏ã‡∏°.',
                '‡∏£‡∏î‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á 7-10 ‡∏ß‡∏±‡∏ô'
            ];
        }

        function drawPruningPoints(points) {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const img = document.getElementById('uploadedImage');
            
            // Set canvas size to match image
            canvas.width = img.offsetWidth;
            canvas.height = img.offsetHeight;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw pruning points
            points.forEach((point, index) => {
                // Adjust coordinates to canvas size
                const x = (point.x / 400) * canvas.width;
                const y = (point.y / 300) * canvas.height;
                
                // Draw circle
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, 2 * Math.PI);
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 3;
                ctx.stroke();
                ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                ctx.fill();
                
                // Draw number
                ctx.fillStyle = '#ff0000';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(index + 1, x, y);
                
                // Draw cutting line
                ctx.beginPath();
                ctx.moveTo(x - 15, y - 15);
                ctx.lineTo(x + 15, y + 15);
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.stroke();
                ctx.setLineDash([]);
            });
        }

        function resetAll() {
            uploadedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('uploadSection').classList.remove('has-image');
            document.getElementById('analyzeBtn').style.display = 'none';
            document.getElementById('resetBtn').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            hideMessages();
            
            // Clear canvas
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.style.display = 'block';
        }

        function showWarning(message) {
            const warningDiv = document.getElementById('warningMessage');
            warningDiv.textContent = '‚ö†Ô∏è ' + message;
            warningDiv.style.display = 'block';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('warningMessage').style.display = 'none';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
