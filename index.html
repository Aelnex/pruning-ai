<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TADDO AI - ‡∏™‡πÅ‡∏Å‡∏ô‡∏û‡∏∑‡∏ä‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1b5e20, #2e7d32, #4caf50);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(139, 195, 74, 0.3) 0%, transparent 50%);
            z-index: -1;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .hero {
            text-align: center;
            padding: 40px 25px;
            background: rgba(255,255,255,0.15);
            border-radius: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }

        .hero-logo {
            font-size: 4em;
            margin-bottom: 20px;
            animation: bounceRotate 3s infinite;
            display: inline-block;
        }

        .hero h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            font-weight: 800;
            background: linear-gradient(45deg, #ffffff, #e8f5e8, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .badge {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.9), rgba(139, 195, 74, 0.9));
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
            margin: 15px 5px;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .demo-badge {
            background: linear-gradient(135deg, #ff9800, #ffb74d);
            animation: pulse-highlight 2s infinite;
        }

        .guide {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.15);
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        .guide h3 {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #e8f5e8;
        }

        .guide-step {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            border-left: 4px solid #4caf50;
        }

        .guide-step:hover {
            transform: translateX(5px);
            background: rgba(255,255,255,0.15);
        }

        .guide-step-number {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .stats {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            animation: fadeInUp 1s ease-out 0.9s both;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stats-item {
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            transition: transform 0.3s ease;
        }

        .stats-item:hover {
            transform: scale(1.05);
        }

        .stats-value {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: block;
        }

        .stats-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        .camera-button, .gallery-button {
            width: 100%;
            padding: 25px;
            border: none;
            border-radius: 20px;
            font-size: 1.4em;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .camera-button {
            background: linear-gradient(135deg, #ffffff, #f5f5f5);
            color: #2e7d32;
            height: 140px;
            font-size: 1.6em;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .gallery-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            height: 70px;
        }

        .camera-button:hover, .gallery-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .camera-button:disabled, .gallery-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            background: rgba(255,255,255,0.15);
            border-radius: 25px;
            margin: 25px 0;
            backdrop-filter: blur(15px);
        }

        .loading.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid #4caf50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .result {
            display: none;
            background: white;
            color: #333;
            border-radius: 25px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        .result.show {
            display: block;
            animation: slideUpResult 0.8s ease-out;
        }

        .result-image {
            width: 100%;
            max-height: 280px;
            object-fit: cover;
            border-radius: 20px;
            margin-bottom: 25px;
        }

        .plant-info {
            background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
            padding: 20px;
            border-radius: 18px;
            margin-bottom: 25px;
            border-left: 5px solid #4caf50;
        }

        .plant-name {
            font-size: 1.6em;
            font-weight: 800;
            color: #2e7d32;
            margin-bottom: 8px;
        }

        .confidence {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.95em;
            font-weight: 600;
            display: inline-block;
            margin-right: 10px;
        }

        .confidence.low {
            background: linear-gradient(135deg, #ff9800, #ffb74d);
        }

        .confidence.very-low {
            background: linear-gradient(135deg, #f44336, #ef5350);
        }

        .cutting-section {
            background: linear-gradient(135deg, #fff8e1, #fffde7);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #f57c00;
            margin-bottom: 15px;
        }

        .cutting-point {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

        .cutting-point:hover {
            transform: translateX(5px);
        }

        .point-title {
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .feedback-section {
            background: linear-gradient(135deg, #e3f2fd, #e1f5fe);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .feedback-section h4 {
            color: #1565c0;
            margin-bottom: 10px;
        }

        .feedback-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
        }

        .feedback-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .btn-correct {
            background: #4caf50;
            color: white;
        }

        .btn-incorrect {
            background: #f44336;
            color: white;
        }

        .feedback-buttons button:hover {
            transform: scale(1.05);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .new-scan, .share-btn, .export-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .new-scan {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
        }

        .share-btn {
            background: white;
            color: #1976d2;
            border: 2px solid #1976d2;
        }

        .export-btn {
            background: white;
            color: #f57c00;
            border: 2px solid #f57c00;
        }

        .error, .success, .warning {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            animation: shake 0.6s ease-in-out;
        }

        .error {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            color: #c62828;
            border-left: 5px solid #f44336;
        }

        .success {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            color: #2e7d32;
            border-left: 5px solid #4caf50;
        }

        .warning {
            background: rgba(255, 193, 7, 0.2);
            color: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .credits {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .file-input {
            display: none;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUpResult {
            from { opacity: 0; transform: translateY(50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(0.98); }
        }

        @keyframes bounceRotate {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            25% { transform: translateY(-10px) rotate(5deg) scale(1.05); }
            50% { transform: translateY(0) rotate(0deg) scale(1); }
            75% { transform: translateY(-5px) rotate(-5deg) scale(1.02); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes pulse-highlight {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.7); }
            50% { box-shadow: 0 0 0 15px rgba(255, 152, 0, 0); }
        }

        @media (max-width: 480px) {
            .container { padding: 15px; }
            .hero h1 { font-size: 2.2em; }
            .stats-grid { grid-template-columns: 1fr; }
        }

        @media print {
            body { background: white; color: black; }
            .no-print { display: none !important; }
            .result { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <div class="hero-logo">üå±</div>
            <h1>TADDO AI</h1>
            <div class="hero-subtitle">‡∏™‡πÅ‡∏Å‡∏ô‡∏û‡∏∑‡∏ä‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</div>
            <div class="badge">‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏û‡∏∑‡∏ä 60,000+ ‡∏ä‡∏ô‡∏¥‡∏î</div>
            <div id="demoBadge" class="badge demo-badge" style="display: none;">üéÆ ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏¥‡∏ï</div>
        </div>

        <div class="guide">
            <h3>üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            <div class="guide-step">
                <div class="guide-step-number">1</div>
                <div>‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÉ‡∏ö ‡∏î‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏•</div>
            </div>
            <div class="guide-step">
                <div class="guide-step-number">2</div>
                <div>‡∏£‡∏≠ TADDO AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä</div>
            </div>
            <div class="guide-step">
                <div class="guide-step-number">3</div>
                <div>‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</div>
            </div>
        </div>

        <div class="stats">
            <div class="stats-grid">
                <div class="stats-item">
                    <span class="stats-value" id="scanCount">0</span>
                    <div class="stats-label">‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="stats-item">
                    <span class="stats-value" id="avgAccuracy">0%</span>
                    <div class="stats-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
                </div>
                <div class="stats-item">
                    <span class="stats-value" id="successRate">0%</span>
                    <div class="stats-label">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="camera-button" id="cameraBtn" onclick="takePhoto()">
                <span>üì± ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏û‡∏∑‡∏ä</span>
            </button>
            <button class="gallery-button" onclick="selectFromGallery()">
                <span>üñºÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á</span>
            </button>
        </div>

        <input type="file" id="photoInput" class="file-input" accept="image/*" capture="environment">
        <input type="file" id="galleryInput" class="file-input" accept="image/*">

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div style="font-size: 1.3em; margin-bottom: 15px;">ü§ñ TADDO AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</div>
            <div id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏†‡∏≤‡∏û...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div id="result" class="result">
            <img id="resultImage" class="result-image">
            <div class="plant-info">
                <div class="plant-name" id="plantName">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä</div>
                <span class="confidence" id="confidence">95%</span>
            </div>

            <div class="cutting-section">
                <div class="section-title">‚úÇÔ∏è ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î</div>
                <div id="cuttingPoints"></div>
            </div>

            <div class="feedback-section">
                <h4>üîç ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</h4>
                <p>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                <div class="feedback-buttons">
                    <button class="btn-correct" onclick="submitFeedback(true)">‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</button>
                    <button class="btn-incorrect" onclick="submitFeedback(false)">‚ùå ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</button>
                </div>
            </div>

            <div class="action-buttons">
                <button class="new-scan" onclick="newScan()">üîÑ ‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
                <button class="share-btn" onclick="shareResult()">üì§ ‡πÅ‡∏ä‡∏£‡πå</button>
                <button class="export-btn no-print" onclick="exportData()">üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>

        <div class="credits">
            <h4>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢</h4>
            <div>‡∏ô‡∏≤‡∏¢‡∏ï‡∏§‡∏ì ‡∏ï‡∏±‡∏ô‡∏ï‡∏£‡∏∞‡∏Å‡∏π‡∏• ‡πÅ‡∏•‡∏∞ ‡∏ô‡∏≤‡∏¢‡∏†‡∏π‡∏®‡∏¥‡∏•‡∏≤ ‡∏Å‡∏≤‡∏™‡∏∏</div>
            <div style="opacity: 0.8; font-size: 0.9em;">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏Ñ‡∏≥‡∏Ñ‡∏ì‡∏≤‡∏ó‡∏£ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏•‡∏≥‡∏û‡∏π‡∏ô</div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            API_KEY: btoa('2b10fVqZpXS2cvXW6EyaPHqJu'), // Simple encoding
            MAX_IMAGE_SIZE: 1200,
            IMAGE_QUALITY: 0.85,
            RATE_LIMIT: 10,
            DEMO_MODE: window.location.search.includes('demo=true')
        };

        // Main Application Class
        class TaddoAI {
            constructor() {
                this.isDemoMode = CONFIG.DEMO_MODE;
                this.cache = new Map();
                this.stats = this.loadStats();
                this.logger = new ResearchLogger();
                this.feedback = new FeedbackSystem();
                this.currentResult = null;
                this.isLoading = false;
                this.scanQueue = [];
                
                this.init();
            }

            init() {
                this.updateUI();
                this.attachEventListeners();
                
                if (this.isDemoMode) {
                    document.getElementById('demoBadge').style.display = 'inline-block';
                    this.showMessage('üéÆ ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏¥‡∏ï - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á', 'warning');
                }

                // Check online status
                window.addEventListener('online', () => this.showMessage('‚úÖ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success'));
                window.addEventListener('offline', () => this.showMessage('üì° ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï', 'error'));
            }

            attachEventListeners() {
                document.getElementById('photoInput').addEventListener('change', (e) => this.handlePhoto(e));
                document.getElementById('galleryInput').addEventListener('change', (e) => this.handlePhoto(e));
            }

            loadStats() {
                return JSON.parse(localStorage.getItem('taddoStats') || JSON.stringify({
                    totalScans: 0,
                    successfulScans: 0,
                    avgConfidence: 0,
                    plantTypes: {},
                    feedbackData: []
                }));
            }

            saveStats() {
                localStorage.setItem('taddoStats', JSON.stringify(this.stats));
            }

            updateUI() {
                document.getElementById('scanCount').textContent = this.stats.totalScans;
                document.getElementById('avgAccuracy').textContent = Math.round(this.stats.avgConfidence) + '%';
                const successRate = this.stats.totalScans > 0 
                    ? Math.round((this.stats.successfulScans / this.stats.totalScans) * 100) 
                    : 0;
                document.getElementById('successRate').textContent = successRate + '%';
            }

            async handlePhoto(event) {
                const file = event.target.files[0];
                if (!file) return;

                if (!file.type.startsWith('image/')) {
                    this.showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                    return;
                }

                try {
                    this.showLoading();
                    this.logger.log('scan_started', { fileSize: file.size, fileType: file.type });

                    // Optimize image
                    const optimizedFile = await this.optimizeImage(file);
                    this.updateProgress(30, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...');

                    // Analyze
                    const result = await this.analyzePlant(optimizedFile);
                    this.updateProgress(100, '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');

                    // Update stats
                    this.updateStats(result);
                    
                    // Show result
                    this.showResult(result, optimizedFile);
                    this.logger.log('scan_completed', result);

                } catch (error) {
                    console.error('Error:', error);
                    this.handleError(error);
                } finally {
                    this.hideLoading();
                    event.target.value = '';
                }
            }

            async optimizeImage(file) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    img.onload = () => {
                        let { width, height } = img;
                        const maxSize = CONFIG.MAX_IMAGE_SIZE;

                        if (width > height && width > maxSize) {
                            height = (height * maxSize) / width;
                            width = maxSize;
                        } else if (height > maxSize) {
                            width = (width * maxSize) / height;
                            height = maxSize;
                        }

                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);

                        canvas.toBlob((blob) => {
                            resolve(new File([blob], file.name, { type: 'image/jpeg' }));
                        }, 'image/jpeg', CONFIG.IMAGE_QUALITY);
                    };

                    img.onerror = reject;
                    img.src = URL.createObjectURL(file);
                });
            }

            async analyzePlant(file) {
                // Demo mode
                if (this.isDemoMode) {
                    await this.sleep(2000);
                    return this.getDemoResult();
                }

                // Check cache
                const cacheKey = await this.getImageHash(file);
                if (this.cache.has(cacheKey)) {
                    return this.cache.get(cacheKey);
                }

                // Real API call
                const formData = new FormData();
                formData.append('images', file);
                formData.append('organs', 'auto');

                const apiKey = atob(CONFIG.API_KEY);
                const projects = ['k-world-flora', 'useful-plants'];

                for (const project of projects) {
                    try {
                        this.updateProgress(50, `‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${project}...`);
                        
                        const response = await fetch(
                            `https://my-api.plantnet.org/v2/identify/${project}?api-key=${apiKey}`,
                            { method: 'POST', body: formData }
                        );

                        if (response.ok) {
                            const data = await response.json();
                            if (data.results && data.results.length > 0) {
                                const result = this.parseResult(data.results[0]);
                                this.cache.set(cacheKey, result);
                                return result;
                            }
                        }
                    } catch (error) {
                        console.log(`Project ${project} failed:`, error);
                    }
                }

                throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô');
            }

            parseResult(result) {
                const species = result.species;
                return {
                    name: this.getCommonName(species),
                    scientificName: species.scientificNameWithoutAuthor,
                    confidence: Math.round(result.score * 100),
                    genus: species.genus?.scientificNameWithoutAuthor || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö',
                    family: species.family?.scientificNameWithoutAuthor || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö'
                };
            }

            getCommonName(species) {
                if (species.commonNames && species.commonNames.length > 0) {
                    const thaiName = species.commonNames.find(name => /[‡∏Å-‡πô]/.test(name));
                    return thaiName || species.commonNames[0];
                }
                return species.scientificNameWithoutAuthor;
            }

            getDemoResult() {
                const demoPlants = [
                    {
                        name: '‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ',
                        scientificName: 'Mangifera indica',
                        confidence: 95,
                        genus: 'Mangifera',
                        family: 'Anacardiaceae'
                    },
                    {
                        name: '‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≠‡∏ô‡∏ó‡∏≠‡∏á',
                        scientificName: 'Durio zibethinus',
                        confidence: 92,
                        genus: 'Durio',
                        family: 'Malvaceae'
                    },
                    {
                        name: '‡∏•‡∏≥‡πÑ‡∏¢‡∏≠‡∏µ‡∏î‡∏≠',
                        scientificName: 'Dimocarpus longan',
                        confidence: 88,
                        genus: 'Dimocarpus',
                        family: 'Sapindaceae'
                    }
                ];
                return demoPlants[Math.floor(Math.random() * demoPlants.length)];
            }

            showResult(result, imageFile) {
                this.currentResult = result;

                // Show image
                const img = document.getElementById('resultImage');
                img.src = URL.createObjectURL(imageFile);

                // Show plant info
                document.getElementById('plantName').innerHTML = `
                    <div>${result.name}</div>
                    <div style="font-size: 0.7em; color: #666; margin-top: 5px;">
                        ${result.scientificName} | ${result.family}
                    </div>
                `;

                // Show confidence
                const confidenceEl = document.getElementById('confidence');
                confidenceEl.textContent = `${result.confidence}%`;
                confidenceEl.className = 'confidence';
                if (result.confidence < 50) confidenceEl.classList.add('very-low');
                else if (result.confidence < 75) confidenceEl.classList.add('low');

                // Generate cutting advice
                const advice = this.getCuttingAdvice(result.genus);
                document.getElementById('cuttingPoints').innerHTML = advice.points
                    .map(p => `
                        <div class="cutting-point">
                            <div class="point-title">${p.title}</div>
                            <div style="color: #666; font-size: 0.9em;">${p.desc}</div>
                        </div>
                    `).join('');

                // Show result section
                document.getElementById('result').classList.add('show');
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            }

            getCuttingAdvice(genus) {
                const adviceDB = {
                    'Mangifera': {
                        points: [
                            { title: '‡∏ï‡∏±‡∏î‡∏Å‡∏¥‡πà‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á', desc: '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏•‡∏≥‡∏ï‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏Å' },
                            { title: '‡∏Å‡∏¥‡πà‡∏á‡∏°‡∏∏‡∏°‡πÅ‡∏Ñ‡∏ö', desc: '‡∏°‡∏∏‡∏°‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 45 ‡∏≠‡∏á‡∏®‡∏≤ ‡∏à‡∏∞‡∏´‡∏±‡∏Å‡∏á‡πà‡∏≤‡∏¢' },
                            { title: '‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡∏î‡∏Å‡∏±‡∏ô', desc: '‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏™‡∏µ' }
                        ]
                    },
                    'Durio': {
                        points: [
                            { title: '‡∏Å‡∏¥‡πà‡∏á‡∏´‡πâ‡∏≠‡∏¢‡∏ï‡πà‡∏≥', desc: '‡∏ö‡∏±‡∏á‡πÅ‡∏™‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß' },
                            { title: '‡∏Å‡∏¥‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô', desc: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®' },
                            { title: '‡∏Å‡∏¥‡πà‡∏á‡∏°‡∏∏‡∏°‡πÅ‡∏Ñ‡∏ö', desc: '‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡∏Å‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ú‡∏•' }
                        ]
                    }
                };

                return adviceDB[genus] || {
                    points: [
                        { title: '‡∏Å‡∏¥‡πà‡∏á‡πÅ‡∏´‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢', desc: '‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ' },
                        { title: '‡∏Å‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô', desc: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏®' },
                        { title: '‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á', desc: '‡∏ï‡∏±‡∏î‡∏Å‡∏¥‡πà‡∏á‡∏ú‡∏¥‡∏î‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á' }
                    ]
                };
            }

            updateStats(result) {
                this.stats.totalScans++;
                if (result.confidence > 50) {
                    this.stats.successfulScans++;
                }
                
                // Update average confidence
                const totalConfidence = (this.stats.avgConfidence * (this.stats.totalScans - 1)) + result.confidence;
                this.stats.avgConfidence = totalConfidence / this.stats.totalScans;

                // Track plant types
                this.stats.plantTypes[result.name] = (this.stats.plantTypes[result.name] || 0) + 1;

                this.saveStats();
                this.updateUI();
            }

            showLoading() {
                this.isLoading = true;
                document.getElementById('loading').classList.add('show');
                document.getElementById('result').classList.remove('show');
                document.getElementById('cameraBtn').disabled = true;
                this.updateProgress(0, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            }

            hideLoading() {
                this.isLoading = false;
                document.getElementById('loading').classList.remove('show');
                document.getElementById('cameraBtn').disabled = false;
            }

            updateProgress(percent, text) {
                document.getElementById('progressFill').style.width = percent + '%';
                if (text) document.getElementById('loadingText').textContent = text;
            }

            showMessage(message, type = 'info') {
                const div = document.createElement('div');
                div.className = type;
                div.textContent = message;
                document.querySelector('.container').insertBefore(div, document.querySelector('.container').firstChild);
                setTimeout(() => div.remove(), 5000);
            }

            handleError(error) {
                if (!navigator.onLine) {
                    this.showMessage('üì° ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï', 'error');
                    this.queueForRetry();
                } else {
                    this.showMessage(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
                }
            }

            queueForRetry() {
                // Save to retry queue
                const queue = JSON.parse(localStorage.getItem('retryQueue') || '[]');
                queue.push({ timestamp: Date.now() });
                localStorage.setItem('retryQueue', JSON.stringify(queue));
            }

            async getImageHash(file) {
                return `${file.size}_${file.lastModified}_${file.name}`;
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Research Logger
        class ResearchLogger {
            constructor() {
                this.logs = [];
                this.sessionId = `session-${Date.now()}`;
            }

            log(event, data) {
                this.logs.push({
                    sessionId: this.sessionId,
                    timestamp: new Date().toISOString(),
                    event,
                    data
                });

                if (this.logs.length >= 10) {
                    this.saveLogs();
                }
            }

            saveLogs() {
                const existing = JSON.parse(localStorage.getItem('researchLogs') || '[]');
                localStorage.setItem('researchLogs', JSON.stringify([...existing, ...this.logs]));
                this.logs = [];
            }
        }

        // Feedback System
        class FeedbackSystem {
            collectFeedback(isCorrect, plantName) {
                const feedback = {
                    isCorrect,
                    plantName,
                    timestamp: new Date().toISOString()
                };

                const allFeedback = JSON.parse(localStorage.getItem('plantFeedback') || '[]');
                allFeedback.push(feedback);
                localStorage.setItem('plantFeedback', JSON.stringify(allFeedback));

                // Show thank you
                const msg = document.createElement('div');
                msg.className = 'success';
                msg.textContent = 'üôè ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•!';
                document.getElementById('result').appendChild(msg);
                setTimeout(() => msg.remove(), 3000);
            }
        }

        // Global instance
        let taddoAI;

        // Global functions
        function takePhoto() {
            if (!taddoAI.isLoading) {
                document.getElementById('photoInput').click();
            }
        }

        function selectFromGallery() {
            if (!taddoAI.isLoading) {
                document.getElementById('galleryInput').click();
            }
        }

        function newScan() {
            document.getElementById('result').classList.remove('show');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function shareResult() {
            if (!taddoAI.currentResult) return;
            
            const text = `üå± ‡∏û‡∏ö: ${taddoAI.currentResult.name}\n‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: ${taddoAI.currentResult.confidence}%\n‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢ TADDO AI`;
            
            if (navigator.share) {
                navigator.share({ title: 'TADDO AI', text, url: window.location.href });
            } else {
                navigator.clipboard.writeText(text);
                taddoAI.showMessage('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        function submitFeedback(isCorrect) {
            if (taddoAI && taddoAI.currentResult) {
                taddoAI.feedback.collectFeedback(isCorrect, taddoAI.currentResult.name);
            }
        }

        function exportData() {
            const stats = JSON.parse(localStorage.getItem('taddoStats') || '{}');
            const logs = JSON.parse(localStorage.getItem('researchLogs') || '[]');
            const feedback = JSON.parse(localStorage.getItem('plantFeedback') || '[]');

            const exportData = {
                stats,
                logs,
                feedback,
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `taddo-data-${Date.now()}.json`;
            a.click();
            
            taddoAI.showMessage('üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', () => {
            taddoAI = new TaddoAI();
            console.log('üå± TADDO AI Initialized - Provincial Edition');
        });
    </script>
</body>
</html>
